title: Detects Authentication Bypass (CVE-2023-46805) and Command Injection (CVE-2024-21887) Exploits
id: 854a754a-54a7-4595-a254-54a7544954a5
version: 1.0
first_imported: 2024-01-18
last_modified: 2024-01-18
status: experimental
sharing: TLP:CLEAR
author: TTC-CERT
description: Detects attempts to exploit an authentication bypass vulnerability in the web component of Ivanti ICS 9.x, 22.x and Ivanti Policy Secure allows a remote attacker to access restricted resources by bypassing control checks.
references:
  - https://attackerkb.com/topics/AdUh6by52K/cve-2023-46805/rapid7-analysis
tags:
  - attack.initial_access
  - attack.t1190
logsource:
  product: ivanti_connect_secure
detection:
  selection1:
    url: /api/v1/totp/user-backup-code/../../  # Detect attempts to bypass authentication
  selection2:
    - url: /api/v1/totp/user-backup-code/../../license/keys-status/%3B  # Identify encoded semicolons for command injection exploits
    - url: /api/v1/totp/user-backup-code/../../license/keys-status/%3b  # Identify encoded semicolons for command injection exploits
  selection3: # Detect command injection exploits with payload in request's JSON content data using a key named 'type'
    url|contains: /api/v1/totp/user-backup-code/../../system/maintenance/archiving/cloud-server-test-connection
  selection4: # Detect command injection exploits with payload in request's JSON content data using a key named 'type'
    url|contains: 'Content-Type: application/json'
  selection5: # Detect command injection exploits with payload in request's JSON content data using a key named 'type'
    url|contains: --data-binary
  selection6: # Detect command injection exploits with payload in request's JSON content data using a key named 'type'
    url|contains: type
  selection7: # Detect command injection exploits with payload in request's JSON content data using a key named 'type'
    url|contains: ;
  condition: selection1 OR selection2 OR (selection3 AND selection4 AND selection5 AND selection6 AND selection7)
falsepositives:
  - Legitimate administrative activity
level: high
